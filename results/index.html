<html>

<head>
  <title>Performance Test</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
</head>

<body>
  <div>
    <canvas id="chart" width="400" height="200"></canvas>
  </div>

  <script>
    var ctx = document.getElementById('chart').getContext('2d');

    fetch('results.json')
      .then(response => response.json())
      .then(rawData => {
        console.log(rawData);

        const datasets = {};

        const colors = [
          "#ef5350", "#ec407a", "#ab47bc", "#7e57c2", "#5c6bc0", "#42a5f5", "#29b6f6", "#26c6da", "#26a69a", "#66bb6a", 
          "#9ccc65", "#d4e157", "#ffee58", "#ffca28", "#ffa726", "#ff7043", "#8d6e63", "#bdbdbd", "#78909c"
        ];

        rawData.forEach((d, i) => {
          if (!datasets[d.payloadSizeInByte]) {
            datasets[d.payloadSizeInByte] = {
              label: `${d.payloadSizeInByte} B`,
              borderColor: colors[i % colors.length],
              fill: false,
              showLine: true,
              data: [],
            }
          }

          datasets[d.payloadSizeInByte].data.push({
            x: d.messagesPerSecond,
            y: d.allSentInMs,
          })
        });

        console.log(Object.values(datasets));

        const chart = new Chart(ctx, {
          type: 'scatter',
          data: {
            datasets: Object.values(datasets),
          },
          options: {
            scales: {
              yAxes: [{
                scaleLabel: {
                  labelString: 'Duration (ms)',
                  display: true,
                },
                ticks: {
                  beginAtZero: true
                }
              }],
              xAxes: [{
                scaleLabel: {
                  labelString: 'Messages per second',
                  display: true,
                }
              }]
            }
          }
        });
      });
  </script>
</body>

</html>